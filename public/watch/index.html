<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>YouTube Script Extractor</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600;700&family=Quicksand:wght@400;600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      .card::before {
        content: "";
        position: absolute;
        top: -50%;
        right: -50%;
        width: 200px;
        height: 200px;
        background: radial-gradient(
          circle,
          rgba(255, 235, 150, 0.2) 0%,
          transparent 70%
        );
        border-radius: 50%;
        pointer-events: none;
      }

      @keyframes slideIn {
        from {
          opacity: 0;
          transform: translateY(-10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .result.show {
        animation: slideIn 0.3s ease;
      }
    </style>
  </head>
  <body
    class="bg-linear-to-br from-cream-200 to-warm-200 font-quicksand min-h-screen p-8 flex items-center justify-center"
  >
    <div class="container max-w-2xl w-full">
      <div
        class="card bg-white rounded-[30px] p-10 shadow-[0_15px_40px_rgba(255,180,100,0.15),0_8px_20px_rgba(255,200,150,0.1)] border-[3px] border-warm-300 relative overflow-hidden"
      >
        <a
          href="/"
          class="inline-block text-warm-500 no-underline mb-6 font-semibold text-base transition-all hover:-translate-x-1 hover:text-warm-600"
          >‚Üê Back</a
        >

        <h1 class="font-fredoka text-warm-500 text-4xl mb-2 font-bold">
          ‚úèÔ∏è YouTube Script Extractor
        </h1>
        <p class="text-brown-400 text-[0.95rem] mb-8 opacity-80">
          Paste a YouTube URL to extract the transcript
        </p>

        <div class="mb-6">
          <label
            for="url"
            class="block text-brown-500 font-semibold mb-2 text-[0.95rem]"
            >YouTube URL</label
          >
          <input
            type="text"
            id="url"
            placeholder="https://youtube.com/watch?v=..."
            autocomplete="off"
            class="w-full px-5 py-4 border-[3px] border-warm-300 bg-warm-50 rounded-2xl text-base font-quicksand text-brown-600 transition-all outline-none focus:border-warm-500 focus:bg-white focus:shadow-[0_0_0_8px_rgba(255,155,106,0.1)] focus:-translate-y-0.5 placeholder:text-brown-300"
          />
        </div>

        <button
          id="extract"
          class="w-full px-6 py-5 text-lg font-bold font-fredoka bg-linear-to-br from-warm-500 to-warm-600 text-white border-none rounded-full cursor-pointer transition-all shadow-[0_8px_20px_rgba(255,155,106,0.3)] tracking-wide hover:not(:disabled):-translate-y-1 hover:not(:disabled):shadow-[0_12px_30px_rgba(255,155,106,0.4)] active:not(:disabled):-translate-y-0 disabled:bg-brown-300/50 disabled:cursor-not-allowed disabled:shadow-[0_4px_10px_rgba(212,196,184,0.2)]"
        >
          Extract Script
        </button>

        <div
          id="result"
          class="hidden mt-8 bg-warm-50 border-[3px] border-dashed border-warm-300 rounded-[20px] overflow-hidden"
        >
          <div
            class="flex items-center justify-end px-6 py-4 border-b-[3px] border-dashed border-warm-300 bg-cream-100"
          >
            <button
              id="copyAll"
              class="px-5 py-2.5 text-sm font-bold font-fredoka bg-linear-to-br from-warm-500 to-warm-600 text-white rounded-full hover:shadow-lg hover:-translate-y-0.5 active:translate-y-0 transition-all"
            >
              üìã Copy All
            </button>
          </div>
          <div
            id="transcriptContent"
            class="p-6 max-h-96 overflow-y-auto text-[0.95rem] text-brown-600 hide-scrollbar"
          ></div>
        </div>
      </div>
    </div>

    <script>
      const urlInput = document.getElementById("url");
      const extractBtn = document.getElementById("extract");
      const result = document.getElementById("result");
      const transcriptContent = document.getElementById("transcriptContent");
      const copyAllBtn = document.getElementById("copyAll");

      let currentUrl = "";
      let currentSegments = [];

      function copyToClipboard(text) {
        // Create temporary textarea
        const textArea = document.createElement("textarea");
        textArea.value = text;
        textArea.style.position = "absolute";
        textArea.style.left = "-9999px";
        textArea.style.top = "0";
        document.body.appendChild(textArea);

        // Select and copy
        textArea.select();
        textArea.setSelectionRange(0, 99999); // For mobile devices

        let success = false;
        try {
          success = document.execCommand("copy");
        } catch (err) {
          console.error("Copy failed:", err);
        }

        document.body.removeChild(textArea);
        return success;
      }

      // Check for video ID in URL params
      const urlParams = new URLSearchParams(window.location.search);
      const videoParam = urlParams.get("v");
      if (videoParam) {
        const videoUrl = `https://youtube.com/watch?v=${videoParam}`;
        urlInput.value = videoUrl;
        // Auto-extract on load
        setTimeout(() => extractBtn.click(), 100);
      }

      copyAllBtn.addEventListener("click", () => {
        const text = currentSegments.map((seg) => seg.text).join(" ");

        const success = copyToClipboard(text);
        const originalText = copyAllBtn.innerHTML;
        copyAllBtn.innerHTML = success ? "‚úì Copied!" : "‚úó Failed";
        copyAllBtn.disabled = true;
        setTimeout(() => {
          copyAllBtn.innerHTML = originalText;
          copyAllBtn.disabled = false;
        }, 2000);
      });

      extractBtn.addEventListener("click", async () => {
        const url = urlInput.value.trim();
        if (!url) return;

        currentUrl = url;
        extractBtn.disabled = true;
        extractBtn.textContent = "Extracting...";
        result.classList.remove("show");
        result.classList.add("hidden");

        try {
          const response = await fetch("/api/youtube-transcript", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ url }),
          });

          const data = await response.json();
          result.classList.remove("hidden");
          result.classList.add("show", "block");

          if (data.success) {
            currentSegments = data.segments;
            result.classList.remove("border-red-300", "bg-red-50");
            result.classList.add("border-green-300", "bg-green-50/50");
            transcriptContent.classList.remove("text-red-600");
            transcriptContent.classList.add("text-brown-600");

            // Extract video ID for links
            const videoId = url.match(
              /(?:youtu\.be\/|youtube\.com(?:\/embed\/|\/v\/|\/watch\?v=|\/watch\?.+&v=))([\w-]{11})/
            )?.[1];

            // Format timestamps and display
            transcriptContent.innerHTML = data.segments
              .map((seg) => {
                const minutes = Math.floor(seg.startMs / 60000);
                const seconds = Math.floor((seg.startMs % 60000) / 1000);
                const totalSeconds = Math.floor(seg.startMs / 1000);
                const timestamp = `${minutes}:${seconds
                  .toString()
                  .padStart(2, "0")}`;
                const youtubeLink = `https://youtube.com/watch?v=${videoId}&t=${totalSeconds}s`;

                return `<div class="mb-3"><span class="font-semibold text-warm-600 cursor-pointer hover:text-warm-700 hover:underline" data-link="${youtubeLink}" title="Click to copy link with timestamp">[${timestamp}]</span> ${seg.text}</div>`;
              })
              .join("");

            // Add click handlers for timestamps
            transcriptContent
              .querySelectorAll("[data-link]")
              .forEach((span) => {
                span.addEventListener("click", () => {
                  const link = span.getAttribute("data-link");
                  const success = copyToClipboard(link);
                  const originalText = span.innerHTML;
                  span.innerHTML = success
                    ? '<span class="text-green-600">‚úì</span>'
                    : '<span class="text-red-600">‚úó</span>';
                  setTimeout(() => {
                    span.innerHTML = originalText;
                  }, 1500);
                });
              });
          } else {
            result.classList.remove("border-green-300", "bg-green-50/50");
            result.classList.add("border-red-300", "bg-red-50");
            transcriptContent.classList.remove("text-brown-600");
            transcriptContent.classList.add("text-red-600");
            transcriptContent.textContent = `Error: ${data.error}`;
          }
        } catch (error) {
          result.classList.remove("hidden");
          result.classList.add("show", "block", "border-red-300", "bg-red-50");
          result.classList.remove("border-green-300", "bg-green-50/50");
          transcriptContent.classList.add("text-red-600");
          transcriptContent.classList.remove("text-brown-600");
          transcriptContent.textContent = `Error: ${error.message}`;
        } finally {
          extractBtn.disabled = false;
          extractBtn.textContent = "Extract Script";
        }
      });

      urlInput.addEventListener("keypress", (e) => {
        if (e.key === "Enter") extractBtn.click();
      });
    </script>
    <div id="elysia"></div>
    <script type="module" src="./index.tsx"></script>
  </body>
</html>
